# üöÄ Render Deployment Checklist

Use this checklist to ensure your deployment is configured correctly.

## Backend Service (Django/Python)

### Environment Variables Required:
- [ ] `DJANGO_SETTINGS_MODULE` = `ccb_portal_backend.production_settings`
- [ ] `SECRET_KEY` (auto-generated by Render)
- [ ] `DATABASE_URL` (auto-populated from database connection)
- [ ] `ALLOWED_HOSTS` = Your backend and frontend domains (comma-separated)
  - Example: `ccb-portal-backend.onrender.com,ccb-portal-frontend.onrender.com,ccb-portal-static.onrender.com`
- [ ] `CORS_ALLOWED_ORIGINS` = Your frontend URL(s) (comma-separated with https://)
  - Example: `https://ccb-portal-frontend.onrender.com,https://ccb-portal-static.onrender.com`
- [ ] `BREVO_API_KEY` (for email functionality)
- [ ] `OPENAI_API_KEY` (optional, for chatbot)

### Disk Configuration:
- [ ] Disk name: `media-disk`
- [ ] Mount path: `/opt/render/project/src/media`
- [ ] Size: 1GB (minimum)

### Build & Start Commands:
- [ ] Build Command: `./build.sh`
- [ ] Start Command: `gunicorn ccb_portal_backend.wsgi:application`

---

## Frontend Service (React Static Site)

### Environment Variables Required:
- [ ] `REACT_APP_API_URL` = Your backend URL **WITHOUT /api suffix**
  - ‚úÖ Correct: `https://ccb-portal-backend.onrender.com`
  - ‚ùå Wrong: `https://ccb-portal-backend.onrender.com/api`
  - ‚ùå Wrong: `https://ccb-portal-backend.onrender.com/`

### Build Configuration:
- [ ] Build Command: `npm install && npm run build`
- [ ] Publish Directory: `build`

### Routes:
- [ ] Rewrite rule: `/*` ‚Üí `/index.html` (for React Router)

---

## Database (PostgreSQL)

### Configuration:
- [ ] Database name: `ccb_portal`
- [ ] User: `ccb_admin`
- [ ] Plan: Free (or higher)
- [ ] Connection string auto-linked to backend service

---

## Post-Deployment Verification

### Backend Health Checks:
- [ ] Backend URL is accessible in browser
- [ ] Visit: `https://your-backend.onrender.com/admin/` (should show Django admin login)
- [ ] Visit: `https://your-backend.onrender.com/api/test/` (should return JSON success message)
- [ ] Visit: `https://your-backend.onrender.com/api/announcements/` (should return JSON with announcements)
- [ ] Check backend logs for any errors

### Frontend Health Checks:
- [ ] Frontend URL loads the home page
- [ ] Visit: `https://your-frontend.onrender.com/`
- [ ] Check browser console (F12) for errors
- [ ] Check Network tab for failed requests
- [ ] Test navigation between pages

### Image Display Checks:
- [ ] Visit News & Events page: `/news`
- [ ] Open browser DevTools (F12)
- [ ] Check Console for image loading errors
- [ ] Check Network tab (filter by "Img") to see image requests
- [ ] Verify images display correctly for:
  - [ ] Announcements
  - [ ] Events
  - [ ] News
  - [ ] Achievements

### Image URLs Should Look Like:
```
https://ccb-portal-backend.onrender.com/media/announcements/image.jpg
https://ccb-portal-backend.onrender.com/media/events/image.jpg
https://ccb-portal-backend.onrender.com/media/news/image.jpg
https://ccb-portal-backend.onrender.com/media/achievements/image.jpg
```

---

## Common Issues & Solutions

### Issue 1: Images not loading (404 errors)
**Cause**: Images don't exist in the database or on disk
**Solution**:
1. Log into Django admin
2. Upload images for announcements, events, news, achievements
3. Check that images appear in the media disk

### Issue 2: CORS errors in browser console
**Cause**: Backend not allowing frontend domain
**Solution**:
1. Update `CORS_ALLOWED_ORIGINS` on backend with frontend URL
2. Include `https://` in the URL
3. Redeploy backend

### Issue 3: API requests fail (can't connect to backend)
**Cause**: `REACT_APP_API_URL` not set or wrong
**Solution**:
1. Set `REACT_APP_API_URL` on frontend service
2. **Must redeploy frontend** after setting (env vars are built into static files)
3. Verify URL is correct (no /api suffix)

### Issue 4: Backend URL shows wrong port or localhost
**Cause**: Using development settings in production
**Solution**:
1. Verify `DJANGO_SETTINGS_MODULE` = `ccb_portal_backend.production_settings`
2. Check backend logs for which settings file is being used
3. Redeploy backend if needed

### Issue 5: Media files disappear after redeploy
**Cause**: Disk not properly configured or mounted
**Solution**:
1. Verify disk is created and mounted in render.yaml
2. Check disk mount path matches `MEDIA_ROOT` in settings
3. Consider using external storage (AWS S3, Cloudinary) for production

---

## Deployment Sequence

When deploying from scratch, follow this order:

1. **Database** (deploy first, wait for ready)
2. **Backend** (deploy second, wait for ready)
   - Database URL auto-populates
   - Run migrations automatically via build.sh
   - Create superuser automatically
3. **Frontend** (deploy last)
   - Set `REACT_APP_API_URL` **BEFORE** first deploy
   - Or set it and redeploy immediately

---

## Monitoring & Maintenance

### Regular Checks:
- [ ] Monitor backend logs for errors
- [ ] Check disk usage (1GB limit on free tier)
- [ ] Test image uploads through admin panel
- [ ] Verify email sending works (contact form)
- [ ] Test all CRUD operations in admin panel

### Free Tier Limitations:
- **Backend**: Spins down after 15 minutes of inactivity (cold starts)
- **Database**: Limited to 90 days of data retention
- **Disk**: 1GB limit, doesn't auto-expand
- **Bandwidth**: 100GB/month

### Performance Tips:
- Keep services active with uptime monitoring (e.g., UptimeRobot)
- Optimize images before uploading (compress, resize)
- Use Render's CDN for static files (automatic)
- Consider paid tier for production use (no cold starts)

---

## Getting Help

If you're stuck:

1. **Check Render Logs**:
   - Backend: Look for Python/Django errors
   - Frontend: Look for build errors
   - Database: Check connection issues

2. **Common Log Errors**:
   - `ModuleNotFoundError`: Missing dependency in requirements.txt
   - `OperationalError`: Database connection issue
   - `ImproperlyConfigured`: Missing environment variable
   - `Static file not found`: Run collectstatic in build.sh

3. **Support Resources**:
   - Render Docs: https://render.com/docs
   - Django Deployment: https://docs.djangoproject.com/en/stable/howto/deployment/
   - This project's docs: See all `*.md` files in root directory

